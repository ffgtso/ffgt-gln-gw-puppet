# this is file is generated by puppet

<% peerings = YAML.load_file(@gre_yaml); -%>
<% peerings.each_pair do |gretun,node| -%>
<% @peers.each do |tunnel,pref| -%>
<% if gretun == tunnel -%>
protocol bgp i_<%= tunnel.gsub('-', '_') %> {
  table mesh;
  local as <%= @our_as %>;
  source address <%= node['ipv6src'] %>;
  neighbor <%= node['ipv6dst'] %> as <%= @our_as %>;
  import filter {
    bgp_local_pref = <%= pref %>;
    if is_default() then accept;
    if in_prefix_range_ibgp() then accept;
    reject;
  };
  export filter {
    if is_default() then accept;
    if in_prefix_range_ibgp() then accept;
    reject;
  };
<% if @next_hop_self != "" -%>  next hop self;
<% end -%>
}

<% end -%>
<% end -%>
<% end -%>
