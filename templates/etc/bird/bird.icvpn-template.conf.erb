# this is file is generated by puppet

# wusel, 2015-08-04: add a route to the mesh table for the ICPVPN network,
# to prevent pings between ICVPN host to go upstream.
protocol static icvpn_static {
  import all;
  table mesh;
  route 10.207.0.0/16 via "icvpn";

  # wusel, 2015-08-05: add a route to the RFC 1918 supernets, we don't want to sent them upstream.
  route 10.0.0.0/16 reject;
  route 172.16.0.0/12 reject;
  route 192.168.0.0/16 reject;
}

# template for icvpn route exchange via bgp
# we exchange freifunk and dn42 routes with peers
# chaosvpn should not be exchanged because chaosvpn misses a route to not
# directly connected communities in the usual setup
template bgp icvpn {
  table mesh;
  local as <%= @icvpn_as %>;
  source address <%= @icvpn_ipv4_address %>;
  import where is_freifunk()<% if @include_chaos == "yes" %> || is_chaos()<% end %><% if @include_dn42 == "yes" %> || is_dn42()<% end %>;
  export where ((source = RTS_BGP) || (source = RTS_STATIC)) && (is_freifunk()<% if @include_chaos == "yes" %> || is_chaos()<% end %><% if @include_dn42 == "yes" %> || is_dn42()<% end %>);
};
