# this file is generated by puppet

# bird community configuration for servers (non-members of the mesh)

table mesh_<%= @mesh_code %>;

#function is_self_<%= @mesh_code %> () {
#  return (proto = "static_<%= @mesh_code %>");
#};

function is_self_<%= @mesh_code %>() {
  return (net ~ [ <%= @srv_ipv4_address %>/32 ]);
};

# pipe between mesh and mesh_<%= @mesh_code %> table
# import only if not in own network.
protocol pipe pipe_mesh_<%=@mesh_code%> {
  table mesh;
  peer table mesh_<%= @mesh_code %>;
  import where ! is_self_<%=@mesh_code %>();
  export where source = RTS_BGP || source = RTS_STATIC;
};
