# this is file is generated by puppet

<% peerings = YAML.load_file(@gre_yaml); -%>
<% peerings.each_pair do |gretun,node| -%>
<% @peers.each do |tunnel,args| -%>
<% if gretun == tunnel -%>
<% array = args.split(';') %>
protocol bgp e_<%= @name.gsub('-', '_') %>_<%= tunnel.gsub('-', '_') %> from ebgp<% if @type == "special" -%>_<%= @name.gsub('-', '_') %><% end -%> {
    source address <%= node['ipv6src'] %>;
    neighbor <%= node['ipv6dst'] %><% if node['ipv6dst']%> % '<%= tunnel %>'<% end -%> as <%= array[0] %>;
    import keep filtered;
    #import filter import_ebgp_<% if @type == "special" -%><%= @name.gsub('-', '_') %><% else %><%= @type %><% end -%>;
    #export filter export_ebgp_<% if @type == "special" -%><%= @name.gsub('-', '_') %><% else %><%= @type %><% end -%>;
    export filter {
      <% if @dont_export_prefix != "none"-%>if (net ~ [<%= @dont_export_prefix %>]) then reject;<% end -%>
      if pass_exp_ebgp_<% if @type == "special" -%><%= @name.gsub('-', '_') %><% else %><%= @type %><% end -%>(<% if @dfz != ""-%>1<% else -%>0<% end -%>) then accept;
      reject;
    }
<% if array[1].to_s != "" -%>    default bgp_local_pref <%= array[1] %>;
<% end -%>
<% if @multihop != "" -%>
<% if @multihop == "true" || @multihop == "yes" -%>    multihop;
<% else -%>    multihop <%= @multihop %>;
<% end -%>
<% end -%>
<% if @password != "" -%>    password "<%= @password %>";
<% end -%>
<% if @bgp_options != "" -%>   <%= @bgp_options %>
<% end -%>
}
<% end -%>
<% end -%>
<% end -%>
