# this is file is generated by puppet

<% @peers.each do |tunnel,args| -%>
<% array = args.split(';') -%>
<% if array[2].to_s != "" -%>
protocol static local_<%= tunnel.gsub('-', '_') %>_2 {
  table mesh;
  route <%= array[2] %> reject;
};

<% end -%>
<% end -%>

<% peerings = YAML.load_file(@gre_yaml); -%>
<% peerings.each_pair do |gretun,node| -%>
<% @peers.each do |tunnel,args| -%>
<% if gretun == tunnel -%>
<% array = args.split(';') %>
protocol bgp ebgp_<%= @name.gsub('-', '_') %>_<%= tunnel.gsub('-', '_') %> from ebgp<% if @type == "special" -%>_<%= @name.gsub('-', '_') %><% end -%> {
    source address <%= node['ipv6src'] %>;
    neighbor <%= node['ipv6dst'] %> as <%= array[0] %>;
    import keep filtered;
    import filter import_ebgp_<% if @type == "special" -%><%= @name.gsub('-', '_') %><% else %><%= @type %><% end -%>;
    export filter export_ebgp_<% if @type == "special" -%><%= @name.gsub('-', '_') %><% else %><%= @type %><% end -%>;
<% if array[1].to_s != "" -%>    default bgp_local_pref <%= array[1] %>;
<% end -%>
<% if @multihop != "" -%>
<% if @multihop == "true" -%>    multihop;
<% else -%>    multihop <%= @multihop %>;
<% end -%>
<% end -%>
<% if @password != "" -%>    password "<%= @password %>";
<% end -%>
<% if @bgp_options != "" -%>   <%= @bgp_options %>
<% end -%>
}
<% end -%>
<% end -%>
<% end -%>
