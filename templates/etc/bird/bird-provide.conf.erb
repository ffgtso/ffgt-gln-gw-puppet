# this file is generated by puppet
#
# ff_gln_gw bird base configuration for providing an IPv4 default route
#
# This file defines basic templates, base protocols and
# finally pulls in every file suffixed with .conf inside 
# of "/etc/bird.conf.d/". So if you like to add aditional
# protocols create a file in that directory.

router id <%= @router_id %>;

# We do use a separate routing table here, it's expected
# that the host is directly serving the IP addresses
# offered for NAT. This is intended to be used for public
# IPv4 addresses on a dedicated host.
#
# peers <-> [mesh] <-> [kernel]

table mesh;

# Check for the IPv4 default route and it's more specific nephew
function is_default() {
  return (net ~ [0.0.0.0/0, 0.0.0.0/1, 128.0.0.0/1]);
}

# do use kernel's routes for bird
#
# We do not import any routes here, therefore we can be sure
# that no funny routes jump into our waggon.
protocol kernel {
  scan time 20;    # Scan kernel routing table every 20 seconds
#  kernel table 42; # routing table for mesh networks
  import where !is_default();     # Import no false defaults!
  export all;                     # Export all routes
};

# This pseudo-protocol watches all interface up/down events.
protocol device {
  scan time 10; # Scan interfaces every 10 seconds 
};

# pipe between mesh table and kernel table
# import everything from mesh table into 
# kernel table and export all routes into mesh.
protocol pipe pipe_kernel_mesh {
  peer table mesh;
  import all;
  export all;
};

# Include puppet generated rules
