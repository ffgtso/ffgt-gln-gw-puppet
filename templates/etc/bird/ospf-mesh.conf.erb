# this file is generated by puppet

# bird OSPF configuration

table ospfmesh_<%= @mesh_code %>;

protocol ospf uplink_<%= @mesh_code %> {
  table mesh;
  import all;
  #import where !is_default();
  export filter {
    if (source = RTS_STATIC || is_default()) then accept;
    reject;
  };

  # Backbone
  area 0 {
    networks {
      <%= @range_ipv4 %>;
    };
<% ospfpeerings = YAML.load_file(@ospf_peerings); -%>
<% ospfpeerings.each_pair do |name,node| -%>
    interface "ospf-<%=name%>" {
      cost 200;
      type pointopoint;
      hello 5; retransmit 2; wait 10; dead 20;
      check link;
      authentication none;
    };

<% end -%>
  };

  area 10 {
<% ospflinks = YAML.load_file(@ospf_link); -%>
<% ospflinks.each_pair do |name,node| -%>
    interface "ospf-<%=name%>" {
      cost node['cost'];
      type pointopoint;
      hello 5; retransmit 2; wait 10; dead 20;
      check link;
      authentication none;
    };

<% end -%>
    interface "br-<%= @mesh_code %>" {
      cost 70;
      stub;
    };
  };
}
