# this file is generated by puppet

# more generic OSPF configuration
# puppet input:
#  - name (implicit via class)       -- peergroup name
#  - prefix6 (e.g. "2001:2016::/32") -- own prefix routes within should be exchanged

table ospf_<%= @name.gsub('-', '_') %>;

# pipe between mesh and ospf_<%= @name.gsub('-', '_') %>
# import all from mesh, export from ospf_xxxx to mesh own network and default route(s)
protocol pipe pipe_ospf_<%= @name.gsub('-', '_') %> {
  table mesh;
  peer table ospf_<%= @name.gsub('-', '_') %>;
  import all;
  export filter {
    if (net ~ [ <%= @prefix6 %> ]) || is_default() then accept;
    reject;
  };
}

filter export_bb_<%= @name.gsub('-', '_') %>  {
    #if (is_default() && (source = RTS_OSPF && ospf_tag = 10)) then reject; # learned from int_XXXX
    if is_default() && source = RTS_BGP then accept;
    if source = RTS_STATIC then accept; #|| is_in_<%= @mesh_code.gsub('-', '_') %>_prefix() then accept;
    reject;
}


